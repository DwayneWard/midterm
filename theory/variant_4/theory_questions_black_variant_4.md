# Теоретическая часть контрольной работы. Вариант 4
## Разработка на Python. Профессиональный

### Вопрос 1
Когда использовать `BackgroundTasks`, а когда APScheduler?

А) APScheduler — для задач, не зависящих от ответа
Б) `BackgroundTasks` для действий после конкретного запроса, APScheduler — для периодических задач
В) APScheduler требует явного вызова `scheduler.start()`
Г) `BackgroundTasks` запускаются сразу, APScheduler — по триггеру

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.



### Вопрос 2
Redis используется для кеша конфигурации. Как обезопасить соединение в проде?

А) Оставить Redis без авторизации
Б) Включить TLS и проверить сертификат
В) Использовать пароль или ACL
Г) Использовать встроенный firewall

**Правильные ответы:** Б, В

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).



### Вопрос 3
Нужно добавить логирование тела ответов для POST-запросов. Как избежать потери данных в ответе?

А) Использовать `response.body_iterator` напрямую без копирования
Б) Использовать `response.body` без создания нового `Response`
В) Скопировать тело, а затем создать новый `Response` с исходными данными
Г) Логировать только заголовки ответа

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 4
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

А) Передавать подключения через аргументы эндпоинта
Б) Создать зависимость `get_cache` для Redis
В) Создать зависимость `get_db` и использовать Depends, возвращая сессию
Г) Создавать соединение внутри эндпоинта через глобальную переменную

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.



### Вопрос 5
Как масштабировать настройку приложения через DI?

А) Определить pydantic-модель `Settings` и инжектить её через зависимость
Б) Читать `.env` внутри каждого эндпоинта
В) Передавать конфигурацию через тело запроса
Г) Хранить настройки в глобальной переменной модуля

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.



### Вопрос 6
Middleware добавляет `user` в `request.state`. Как защититься от отсутствия пользователя?

А) Читать пользователя из `request.headers.get("X-User")`
Б) В эндпоинтах проверять `hasattr(request.state, "user")` и бросать 401 при отсутствии
В) Использовать dependency injection с проверкой наличия пользователя
Г) Использовать `request.app.state.user` для хранения пользователя

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 7
Кеш API иногда даёт устаревшие данные. Какие причины наиболее вероятны? Отметь все подходящие варианты.

А) Источник обновил данные без сброса кеша
Б) Несогласованность между инстансами, использующими разные ключи
В) TTL слишком большой
Г) Кеш не был инвалидирован после обновления данных

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 8
Как сохранить состояние планировщика при рестарте приложения?

А) Использовать `scheduler.shutdown()` при завершении приложения
Б) Запускать APScheduler в отдельном процессе
В) Использовать persistent job store (Redis, БД)
Г) Настроить `lifespan` для управления жизненным циклом

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.



### Вопрос 9
Middleware собирает метрики времени. Какие значения нужно логировать? Отметь все подходящие варианты.

А) Время ответа
Б) Количество запросов в секунду
В) `latency`
Г) Время начала

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.



### Вопрос 10
Эндпоинт возвращает отчёт, который пересчитывается раз в сутки. Как сохранить производительность и актуальность? Отметь все подходящие варианты.

А) Использовать ленивое обновление (stale-while-revalidate)
Б) Использовать только TTL без событийной инвалидации
В) Кешировать отчёт с суточным TTL и инвалидировать при обновлении
Г) Кешировать отчёт с очень коротким TTL (несколько минут)

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.



### Вопрос 11
Почему DI помогает поддерживать крупные проекты? Отметь все подходящие варианты.

А) Упрощает рефакторинг зависимостей без изменения всех эндпоинтов
Б) Позволяет тестировать код с заглушками
В) Централизует управление ресурсами
Г) Упрощает замену реализаций сервисов

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.



### Вопрос 12
Логирование перегружается из-за лишних полей. Что нужно оставить для технических логов? Отметь все подходящие варианты.

А) `request_id`
Б) `status_code`
В) `message`
Г) `path`

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 13
Создаётся общая обёртка вокруг кеша в FastAPI. Какие элементы нужно включить? Отметь все подходящие варианты.

А) Функцию генерации ключей
Б) Инвалидацию при записи в БД
В) Обработку ошибок при работе с Redis
Г) Сериализацию ответов

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.



### Вопрос 14
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Использовать общий форматтер для всех логгеров через `basicConfig`
Б) Настроить общий форматтер и подключить его ко всем логгерам
В) Создать middleware, которое добавляет формат каждому сообщению
Г) Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст

**Правильные ответы:** Б, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 15
В новом проекте внедряется middleware, который должен проставлять `request_id` и `correlation_id`. Как сохранить оба значения для дальнейших обработчиков?

А) Записать их в `request.state`, а затем добавить заголовки после `call_next`
Б) Передавать через заголовки запроса
В) Сохранить в `request.app.state` для всех запросов
Г) Использовать только `request_id`, игнорируя `correlation_id`

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 16
Ключ кеша должен учитывать параметры фильтра `region` и `department`. Как оформить ключ, чтобы команда могла его поддерживать?

**Правильный ответ:** Например, `f"metrics:{region}:{department}"` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения и как структурировать ключи.



### Вопрос 17
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Настроить `lifespan` для управления жизненным циклом
Б) Добавить задачу с `IntervalTrigger(minutes=15)`
В) Запустить `scheduler.start()`
Г) Создать `AsyncIOScheduler`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.



### Вопрос 18
Нужно сбросить кеш конкретного клиента при изменении его данных. Какие шаги подходят? Отметь все подходящие варианты.

А) Ждать истечения TTL
Б) Использовать префикс `client:<id>` и удалять через `SCAN`
В) Хранить ключи клиента в `SET` и удалять их
Г) Использовать `KEYS client:<id>:*` и удалять найденные ключи

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 19
Как узнать, сколько осталось до истечения ключа `dashboard:data`?

А) `TTL dashboard:data`
Б) `GET dashboard:data`
В) `EXPIRE dashboard:data 60`
Г) `PTTL dashboard:data`

**Правильные ответы:** А, Г

**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.



### Вопрос 20
Метод `/metrics` обновляется каждые 15 минут. Какой TTL поставить для кеша ответа, чтобы балансировать свежесть и нагрузку?

А) 15 минут
Б) 1 час
В) 5 минут
Г) Без кеша

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.



### Вопрос 21
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?
```python
async def get_redis():
    async with aioredis.from_url(URL) as conn:
        yield conn
```
(принимаются эквиваленты с `yield`)
**Проверяемый ОР:** Понимает. - Как асинхронные зависимости улучшают производительность приложения.



### Вопрос 22
Нужно, чтобы middleware добавляло `X-Service-Version` в каждый ответ. Какие шаги нужны? Отметь все подходящие варианты.

А) Вызвать `response = await call_next(request)`
Б) В middleware получить версию сервиса
В) Добавить заголовок `response.headers["X-Service-Version"]`
Г) Добавить заголовок в `request.headers` до вызова `call_next`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 23
Создаётся middleware для логирования запросов. В чём разница между функциональным подходом (`@app.middleware("http")`) и классовым (`BaseHTTPMiddleware`)?

А) Функциональный подход проще для простых случаев, классовый — для сложной логики
Б) Функциональный подход не позволяет передавать параметры конфигурации, классовый позволяет через конструктор
В) Классовый подход требует наследования от `BaseHTTPMiddleware`
Г) Функциональный подход требует явного указания типа middleware

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 24
Нужно удалить кеш при обновлении товара. Какую команду Redis использовать?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 25
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

А) Логировать ошибки
Б) Оборачивать задачу в try/except
В) Использовать `scheduler.shutdown()` при завершении приложения
Г) Добавить уведомления при исключениях

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.



### Вопрос 26
В логах нужно быстро находить записи по пользователю. Какие поля включить? Отметь все подходящие варианты.

А) `user_id`
Б) `message`
В) `timestamp`
Г) `level`

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.



### Вопрос 27
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
Б) Хранить ключ в глобальной переменной без проверки
В) Использовать middleware без проверки ключа
Г) Проверять ключ внутри каждого эндпоинта

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.



### Вопрос 28
На каком уровне логировать успешное завершение фоновой задачи?

А) WARNING
Б) INFO
В) DEBUG
Г) ERROR

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.

