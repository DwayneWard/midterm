# Теоретическая часть контрольной работы. Вариант 1
## Разработка на Python. Профессиональный

### Вопрос 1
Нужно настроить формат логов. Какие поля нужно включить? Отметь все подходящие варианты.

А) Уровень
Б) Имя логгера
В) Уникальный идентификатор запроса (`request_id`)
Г) Время события

**Правильные ответы:** А, Б, В, Г

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.



### Вопрос 2
Нужно быстро узнать, сколько ещё живёт ключ `session:<id>`. Какой командой воспользоваться?
А) `PTTL session:<id>`
Б) `EXPIRE session:<id> 60`
В) `TTL session:<id>`
Г) `GET session:<id>`

**Правильный ответ:** В
**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.



### Вопрос 3
Логи стали нечитаемыми: много строк, нет структуры. Как перейти на структурированное логирование? Отметь все подходящие варианты.

А) Добавить контекст (request_id, user_id)
Б) Использовать `logging` с JSON-форматтером
В) Логировать в stdout
Г) Использовать структурированный формат с обязательными полями

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 4
Нужно логировать время обработки запроса. Какие данные нужно сохранить в контексте? Отметь все подходящие варианты.

А) Время начала (timestamp)
Б) `request.state.user`
В) `request.method`
Г) `request.url.path`

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.



### Вопрос 5
На продакшн-сервисе добавлен middleware, который создаёт `request_id` через `uuid4` и пишет его в `request.state`. Что нужно вернуть из middleware, чтобы цепочка обработчиков продолжилась?

А) Результат вызова `await call_next(request)`
Б) `JSONResponse` с данными из `request.state`
В) Объект `request` без изменений
Г) Результат `call_next`, обёрнутый в дополнительный middleware

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 6
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься? Отметь все подходящие варианты.

А) Логировать ошибки
Б) Добавить уведомления при исключениях
В) Использовать `scheduler.shutdown()` при завершении приложения
Г) Оборачивать задачу в try/except

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.



### Вопрос 7
Перед релизом команды обсуждают архитектуру кеша для API каталога. Какие компоненты точно понадобятся? Отметь все подходящие варианты.
А) Логика формирования ключей кеша
Б) Сериализация ответа для записи в Redis
В) Middleware или dependency, которая проверяет кеш
Г) Инвалидация при изменении данных

**Правильные ответы:** Б, В, Г
**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.



### Вопрос 8
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Создать `AsyncIOScheduler`
Б) Запустить `scheduler.start()`
В) Добавить задачу с `IntervalTrigger(minutes=15)`
Г) Настроить `lifespan` для управления жизненным циклом

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.



### Вопрос 9
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения? Отметь все подходящие варианты.

А) Создать зависимость `get_db` и использовать Depends, возвращая сессию
Б) Создать зависимость `get_cache` для Redis
В) Передавать подключения через аргументы эндпоинта
Г) Создавать соединение внутри эндпоинта через глобальную переменную

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.



### Вопрос 10
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Проверять ключ внутри каждого эндпоинта
Б) Хранить ключ в глобальной переменной без проверки
В) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
Г) Использовать middleware без проверки ключа

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.



### Вопрос 11
Нужно хранить пользовательский кеш в Redis. Как сформировать ключ для кеша пользователя?

**Правильный ответ:** Например, `f"user:{user_id}:feed"` (принимаются эквиваленты с неймспейсами)

**Проверяемый ОР:** Понимает. - Какие данные лучше кешировать и как структурировать ключи.



### Вопрос 12
На ревью производительности обсуждают функцию `get_or_set_cache`, которая должна работать с Redis. Какие шаги обязательны? Отметь все подходящие варианты.

А) Возвращать данные из кеша без проверки наличия ключа
Б) Попробовать получить значение по ключу
В) Если нет кеша — вычислить данные и записать с TTL
Г) Обрабатывать ошибки подключения к Redis

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как кеширование помогает снизить нагрузку на базу данных.



### Вопрос 13
В middleware логирования нужно записать тело ответа. Почему нужно осторожно читать `response.body_iterator`? Отметь все подходящие причины.

А) Логирование больших тел увеличивает задержки
Б) Итератор `body_iterator` можно прочитать только один раз без восстановления
В) Повторное чтение может опустошить поток
Г) Нужно заново создавать `Response`

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 14
Реализуется трассировка: middleware должен добавлять `X-Request-ID` в ответ. Где это сделать?

А) После получения `response = await call_next(request)` добавить заголовок и вернуть
Б) До вызова `call_next` выставить заголовок в `request.headers`
В) Использовать декоратор на уровне эндпоинта вместо middleware
Г) Добавить заголовок в `request.state` и обработать в эндпоинте

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 15
При изменении цен в БД нужно обновить кеш, чтобы покупатели видели актуальные данные. Какие стратегии инвалидации подходят? Отметь все подходящие варианты.

А) Инвалидация при событии обновления данных
Б) TTL по времени
В) Инвалидация по расписанию (батч-очистка ключей по префиксу)
Г) Ручное удаление ключей через команду Redis

**Правильные ответы:** А, Б, В, Г
**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 16
Нужно удалить кеш при обновлении товара. Какую команду Redis использовать?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.


### Вопрос 17
Нужно отправлять отчёт в 08:00 по будням. Какой триггер APScheduler выбрать?

**Правильный ответ:** `CronTrigger(day_of_week="mon-fri", hour=8, minute=0)` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Почему фоновые задачи важны для выполнения длительных операций.



### Вопрос 18
Middleware авторизации кладёт `user_id` в `request.state.user_id`. В эндпоинте `@app.get("/profile")` нужно получить значение `user_id`. Как получить значение `user_id`?

А) `request.state.user_id`
Б) `request.app.state.user_id`
В) `request.headers.get("X-User-Id")`
Г) `request.cookies.get("user_id")`

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 19
Нужно кешировать ответ `GET /products`. Какую TTL выбрать для данных, обновляющихся каждые 10 минут?

А) 10 секунд
Б) 600 секунд
В) 1 час
Г) 300 секунд

**Правильный ответ:** Б

**Проверяемый ОР:** Понимает. - Как кеширование помогает снизить нагрузку на базу данных.



### Вопрос 20
Зачем использовать DI при поддержке больших приложений? Отметь все подходящие варианты.

А) Можно подключать разные реализации сервисов в зависимости от окружения
Б) Упрощает тестирование за счёт возможности подмены зависимостей
В) Зависимости можно централизованно обновлять и рефакторить без правок во всех эндпоинтах
Г) Проще контролировать жизненный цикл ресурсов (открытие/закрытие соединений)

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.



### Вопрос 21
Какой уровень логирования использовать для информации о запуске плановой задачи?

А) INFO
Б) CRITICAL
В) ERROR
Г) DEBUG

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.



### Вопрос 22
Приложение пишет логи напрямую из эндпоинтов, и записи без request_id. Как исправить? Отметь все подходящие варианты.

А) Передавать `request_id` в контексте логгера через middleware
Б) Использовать `LoggerAdapter` для автоматического добавления контекста
В) Использовать `logger = logging.getLogger(__name__)` и добавлять `extra`
Г) Использовать `logger = logging.getLogger(__name__)` и не добавлять `extra`

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 23
Redis используется как кеш для списка популярных товаров. Какие ключевые параметры подключения важно определить? Отметь все подходящие варианты.

А) Номер базы данных
Б) Пароль для аутентификации
В) Таймаут соединения
Г) Хост и порт Redis

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).



### Вопрос 24
BackgroundTasks FastAPI запускает пост-обработку письма. Чем он отличается от APScheduler? Отметь все подходящие варианты.

А) APScheduler требует явного вызова `scheduler.start()`
Б) BackgroundTasks выполняет задачи после ответа на конкретный запрос
В) APScheduler запускает задачи по расписанию без привязки к запросу
Г) BackgroundTasks не подходит для периодических задач

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.



### Вопрос 25
Нужно инжектировать конфигурацию приложения в несколько эндпоинтов. Какой подход масштабируется?

А) Использовать глобальную переменную в модуле
Б) Читать файл конфигурации в каждом эндпоинте
В) Создать зависимость `get_settings`, возвращающую объект настроек
Г) Передавать настройки через аргументы вручную

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.



### Вопрос 26
Middleware проверяет заголовок `Authorization`. Какие шаги нужны, чтобы вернуть 401 при отсутствии токена? Отметь все подходящие варианты.

А) При отсутствии токена вернуть `JSONResponse(status_code=401, content=...)` и вызвать `call_next`
Б) Считать заголовок из `request.headers`
В) При отсутствии токена вернуть `JSONResponse(status_code=401, content=...)` без вызова `call_next`
Г) Пробрасывать запрос дальше без изменений

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как middleware может улучшить безопасность приложения.



### Вопрос 27
Отчёт о популярных товарах пересчитывается бэкендом раз в час, но нужны актуальные данные. Какие подходы помогут балансировать скорость и актуальность? Отметь все подходящие варианты.

А) Периодически пересчитывать и перезаписывать кеш
Б) Задать короткий TTL и инвалидацию по событию, когда источник данных обновляется
В) Кешировать без TTL и не обновлять данные
Г) Использовать только TTL без событийной инвалидации

**Правильные ответы:** А, Б
**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.

