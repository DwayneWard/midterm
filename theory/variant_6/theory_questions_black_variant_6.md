# Теоретическая часть контрольной работы. Вариант 6
## Разработка на Python. Профессиональный

### Вопрос 1
Эндпоинт `/prices` обновляется каждые 2 минуты. Какой TTL поставить для кеша ответа?

А) 30 минут
Б) 120 секунд
В) 5 секунд
Г) Без TTL

**Правильный ответ:** Б

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.



### Вопрос 2
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

А) Оборачивать задачу в try/except
Б) Логировать ошибки
В) Использовать `scheduler.shutdown()` при завершении приложения
Г) Добавить уведомления при исключениях

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.



### Вопрос 3
Как внедрять настройки приложения через DI?

А) Передавать настройки через заголовки
Б) Создать `Settings` на базе `pydantic` и инжектировать через зависимость
В) Хранить настройки в глобальной переменной модуля
Г) Читать `.env` в каждом эндпоинте

**Правильный ответ:** Б

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.



### Вопрос 4
Нужно централизованно проставлять `X-Env` в ответах. Какие шаги нужны в middleware? Отметь все подходящие варианты.

А) Добавить заголовок в `response.headers`
Б) Вызвать `response = await call_next(request)`
В) Получить значение окружения из настроек
Г) Добавить заголовок в `request.headers` до вызова `call_next`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 5
Как быстро посмотреть, сколько осталось жить ключу `promo:active`?

А) `PTTL promo:active`
Б) `GET promo:active`
В) `EXPIRE promo:active 60`
Г) `TTL promo:active`

**Правильные ответы:** А, Г

**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.



### Вопрос 6
В сервисе добавляется middleware для проставления `trace_id`. Где генерировать идентификатор, чтобы он попал во все downstream-вызовы?

А) После получения ответа
Б) В отдельном middleware, который выполняется последним
В) В dependency injection через `Depends`
Г) До `await call_next(request)`, сохранив значение в `request.state` и заголовках

**Правильный ответ:** Г

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 7
Отчёты формируются долго, но обновляются каждые 4 часа. Как держать данные актуальными и снизить нагрузку? Отметь все подходящие варианты.

А) Использовать только TTL без событийной инвалидации
Б) Настроить фоновые задачи, обновляющие кеш заранее
В) Кешировать результаты и инвалидировать по событию
Г) Кешировать отчёт с очень коротким TTL (несколько минут)

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.



### Вопрос 8
Логируется тело ответа в middleware. Какие риски стоит учитывать? Отметь все подходящие варианты.

А) Потребуется восстановить поток, иначе клиент получит пустой ответ
Б) В логи могут попасть ПДн
В) Тело ответа можно читать только один раз без восстановления потока
Г) Увеличатся задержки из-за сериализации

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 9
Как сбросить кеш сегмента клиентов при обновлении данных?

А) Использовать `KEYS segment:<id>:*` и удалять найденные ключи
Б) Хранить ключи сегмента в `SET` и удалять их
В) Удалять по `segment:<id>:*` через `SCAN`
Г) Ждать истечения TTL

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 10
Redis используется как кеш для справочников. Какие параметры клиента критичны? Отметь все подходящие варианты.

А) Количество попыток переподключения
Б) Таймаут подключения
В) Таймаут команд
Г) Пароль для аутентификации

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).



### Вопрос 11
Middleware добавляет `user_id` в `request.state`. Как безопасно использовать его в зависимости?

А) Читать `user_id` из `request.headers.get("X-User-Id")`
Б) Использовать `request.app.state.user_id` для хранения
В) Проверить наличие атрибута и вернуть 401 при отсутствии
Г) Использовать dependency injection без проверки наличия значения

**Правильный ответ:** В

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 12
Создаётся кеширующий слой. Какие компоненты обязательны? Отметь все подходящие варианты.

А) Функция формирования ключей
Б) Сериализация/десериализация данных
В) Инвалидация при событии обновления
Г) Обработка ошибок при работе с Redis

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.



### Вопрос 13
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

А) Создать зависимость `get_db` и использовать Depends, возвращая сессию
Б) Создавать соединение внутри эндпоинта через глобальную переменную
В) Создать зависимость `get_cache` для Redis
Г) Передавать подключения через аргументы эндпоинта

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.



### Вопрос 14
Ключ кеша должен учитывать `product_id` и `currency`. Как построить ключ, чтобы поддержка понимала структуру?

**Правильный ответ:** Например, `f"price:{product_id}:{currency}"` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения и как структурировать ключи.



### Вопрос 15
Почему DI облегчает поддержку и развитие сервисов? Отметь все подходящие варианты.

А) Централизует контроль жизненного цикла ресурсов
Б) Позволяет подменять реализации (mock vs prod)
В) Упрощает тестирование за счёт заглушек
Г) Упрощает рефакторинг зависимостей без изменения всех эндпоинтов

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.



### Вопрос 16
Чтобы логи были пригодны для анализа инцидентов, какие поля нужно добавить? Отметь все подходящие варианты.

А) `message`
Б) `timestamp`
В) `level`
Г) `service`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.



### Вопрос 17
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?
```python
async def get_redis():
    async with aioredis.from_url(URL) as conn:
        yield conn
```
(принимаются эквиваленты с `yield`)
**Проверяемый ОР:** Понимает. - Как асинхронные зависимости улучшают производительность приложения.



### Вопрос 18
Чем `BackgroundTasks` отличается от APScheduler? Отметь все подходящие варианты.

А) APScheduler требует явного вызова `scheduler.start()`
Б) APScheduler работает по расписанию
В) `BackgroundTasks` привязан к конкретному запросу
Г) `BackgroundTasks` запускает действия сразу после ответа

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.



### Вопрос 19
Какой уровень логирования выбрать для неожиданной ошибки бизнес-логики?

А) WARNING
Б) INFO
В) ERROR
Г) DEBUG

**Правильный ответ:** В

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.



### Вопрос 20
Измеряется время ответа в middleware. Что записывать в лог? Отметь все подходящие варианты.

А) Размер ответа в байтах
Б) Продолжительность запроса
В) Timestamp окончания
Г) Timestamp начала

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.



### Вопрос 21
Подключается middleware через `app.add_middleware(LoggingMiddleware)`. Какой базовый класс должен наследовать `LoggingMiddleware` для такого способа подключения?

А) Любой класс с методом `async def dispatch`
Б) `Middleware` из `fastapi.middleware`
В) `ASGIMiddleware` из `starlette.middleware`
Г) `BaseHTTPMiddleware` из `starlette.middleware.base`

**Правильный ответ:** Г

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 22
Логирование заполняет диски, нужно оставить только полезные поля. Что нужно логировать? Отметь все подходящие варианты.

А) `request_id`
Б) `status_code`
В) `message`
Г) `method`

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 23
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Использовать middleware без проверки ключа
Б) Хранить ключ в глобальной переменной без проверки
В) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
Г) Проверять ключ внутри каждого эндпоинта

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.



### Вопрос 24
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Настроить `lifespan` для управления жизненным циклом
Б) Добавить задачу с `IntervalTrigger(minutes=15)`
В) Запустить `scheduler.start()`
Г) Создать `AsyncIOScheduler`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.



### Вопрос 25
Как обеспечить сохранность расписания при рестарте приложения?

А) Настроить `lifespan` для управления жизненным циклом
Б) Использовать persistent job store (Redis, БД)
В) Использовать `scheduler.shutdown()` при завершении приложения
Г) Запускать APScheduler в отдельном процессе

**Правильные ответы:** Б, Г

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.



### Вопрос 26
Кеш возвращает устаревшие данные по заказам. Какие причины стоит проверить? Отметь все подходящие варианты.

А) Кеш не был инвалидирован после обновления данных
Б) TTL слишком длинный
В) Нет инвалидации после обновления заказов
Г) Разные сервисы используют разные префиксы ключей

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 27
Как удалить кеш при обновлении товара? Какую команду Redis использовать?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 28
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Создать middleware, которое добавляет формат каждому сообщению
Б) Использовать общий форматтер для всех логгеров через `basicConfig`
В) Настроить общий форматтер и подключить его ко всем логгерам
Г) Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст

**Правильные ответы:** В, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

