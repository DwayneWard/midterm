# Теоретическая часть контрольной работы
## Вариант 1

**Дисциплина:** Разработка на Python. Профессиональный

**Фамилия, Имя:** _________________________________

---

### Вопрос 1
Нужно настроить формат логов. Какие поля нужно включить? Отметь все подходящие варианты.

- [ ] Уровень
- [ ] Имя логгера
- [ ] Уникальный идентификатор запроса (`request_id`)
- [ ] Время события

### Вопрос 2
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?

**Ответ:**

_________________________________


### Вопрос 3
Нужно быстро узнать, сколько ещё живёт ключ `session:<id>`. Какой командой воспользоваться?

- [ ] `PTTL session:<id>`
- [ ] `EXPIRE session:<id> 60`
- [ ] `TTL session:<id>`
- [ ] `GET session:<id>`

### Вопрос 4
Логи стали нечитаемыми: много строк, нет структуры. Как перейти на структурированное логирование? Отметь все подходящие варианты.

- [ ] Добавить контекст (request_id, user_id)
- [ ] Использовать `logging` с JSON-форматтером
- [ ] Логировать в stdout
- [ ] Использовать структурированный формат с обязательными полями

### Вопрос 5
Нужно логировать время обработки запроса. Какие данные нужно сохранить в контексте? Отметь все подходящие варианты.

- [ ] Время начала (timestamp)
- [ ] `request.state.user`
- [ ] `request.method`
- [ ] `request.url.path`

### Вопрос 6
На продакшн-сервисе добавлен middleware, который создаёт `request_id` через `uuid4` и пишет его в `request.state`. Что нужно вернуть из middleware, чтобы цепочка обработчиков продолжилась?

- [ ] Результат вызова `await call_next(request)`
- [ ] `JSONResponse` с данными из `request.state`
- [ ] Объект `request` без изменений
- [ ] Результат `call_next`, обёрнутый в дополнительный middleware

### Вопрос 7
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

- [ ] Логировать ошибки
- [ ] Добавить уведомления при исключениях
- [ ] Использовать `scheduler.shutdown()` при завершении приложения
- [ ] Оборачивать задачу в try/except

### Вопрос 8
Перед релизом команды обсуждают архитектуру кеша для API каталога. Какие компоненты точно понадобятся? Отметь все подходящие варианты.

- [ ] Логика формирования ключей кеша
- [ ] Сериализация ответа для записи в Redis
- [ ] Middleware или dependency, которая проверяет кеш
- [ ] Инвалидация при изменении данных

### Вопрос 9
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

- [ ] Создать `AsyncIOScheduler`
- [ ] Запустить `scheduler.start()`
- [ ] Добавить задачу с `IntervalTrigger(minutes=15)`
- [ ] Настроить `lifespan` для управления жизненным циклом

### Вопрос 10
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

- [ ] Создать зависимость `get_db` и использовать Depends, возвращая сессию
- [ ] Создать зависимость `get_cache` для Redis
- [ ] Передавать подключения через аргументы эндпоинта
- [ ] Создавать соединение внутри эндпоинта через глобальную переменную

### Вопрос 11
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

- [ ] Проверять ключ внутри каждого эндпоинта
- [ ] Хранить ключ в глобальной переменной без проверки
- [ ] Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
- [ ] Использовать middleware без проверки ключа

### Вопрос 12
Нужно хранить пользовательский кеш в Redis. Как сформировать ключ для кеша пользователя?

**Ответ:**

_________________________________


### Вопрос 13
На ревью производительности обсуждают функцию `get_or_set_cache`, которая должна работать с Redis. Какие шаги обязательны? Отметь все подходящие варианты.

- [ ] Возвращать данные из кеша без проверки наличия ключа
- [ ] Попробовать получить значение по ключу
- [ ] Если нет кеша — вычислить данные и записать с TTL
- [ ] Обрабатывать ошибки подключения к Redis

### Вопрос 14
В middleware логирования нужно записать тело ответа. Почему нужно осторожно читать `response.body_iterator`? Отметь все подходящие причины.

- [ ] Логирование больших тел увеличивает задержки
- [ ] Итератор `body_iterator` можно прочитать только один раз без восстановления
- [ ] Повторное чтение может опустошить поток
- [ ] Нужно заново создавать `Response`

### Вопрос 15
Реализуется трассировка: middleware должен добавлять `X-Request-ID` в ответ. Где это сделать?

- [ ] После получения `response = await call_next(request)` добавить заголовок и вернуть
- [ ] До вызова `call_next` выставить заголовок в `request.headers`
- [ ] Использовать декоратор на уровне эндпоинта вместо middleware
- [ ] Добавить заголовок в `request.state` и обработать в эндпоинте

### Вопрос 16
При изменении цен в БД нужно обновить кеш, чтобы покупатели видели актуальные данные. Какие стратегии инвалидации подходят? Отметь все подходящие варианты.

- [ ] Инвалидация при событии обновления данных
- [ ] TTL по времени
- [ ] Инвалидация по расписанию (батч-очистка ключей по префиксу)
- [ ] Ручное удаление ключей через команду Redis

### Вопрос 17
Нужно удалить кеш при обновлении товара. Какую команду Redis использовать?

**Ответ:**

_________________________________


### Вопрос 18
Нужно отправлять отчёт в 08:00 по будням. Какой триггер APScheduler выбрать?

**Ответ:**

_________________________________


### Вопрос 19
Middleware авторизации кладёт `user_id` в `request.state.user_id`. В эндпоинте `@app.get("/profile")` нужно получить значение `user_id`. Как получить значение `user_id`?

- [ ] `request.state.user_id`
- [ ] `request.app.state.user_id`
- [ ] `request.headers.get("X-User-Id")`
- [ ] `request.cookies.get("user_id")`

### Вопрос 20
Нужно кешировать ответ `GET /products`. Какую TTL выбрать для данных, обновляющихся каждые 10 минут?

- [ ] 10 секунд
- [ ] 600 секунд
- [ ] 1 час
- [ ] 300 секунд

### Вопрос 21
Зачем использовать DI при поддержке больших приложений? Отметь все подходящие варианты.

- [ ] Можно подключать разные реализации сервисов в зависимости от окружения
- [ ] Упрощает тестирование за счёт возможности подмены зависимостей
- [ ] Зависимости можно централизованно обновлять и рефакторить без правок во всех эндпоинтах
- [ ] Проще контролировать жизненный цикл ресурсов (открытие/закрытие соединений)

### Вопрос 22
Какой уровень логирования использовать для информации о запуске плановой задачи?

- [ ] INFO
- [ ] CRITICAL
- [ ] ERROR
- [ ] DEBUG

### Вопрос 23
Приложение пишет логи напрямую из эндпоинтов, и записи без request_id. Как исправить? Отметь все подходящие варианты.

- [ ] Передавать `request_id` в контексте логгера через middleware
- [ ] Использовать `LoggerAdapter` для автоматического добавления контекста
- [ ] Использовать `logger = logging.getLogger(__name__)` и добавлять `extra`
- [ ] Использовать `logger = logging.getLogger(__name__)` и не добавлять `extra`

### Вопрос 24
Redis используется как кеш для списка популярных товаров. Какие ключевые параметры подключения важно определить? Отметь все подходящие варианты.

- [ ] Номер базы данных
- [ ] Пароль для аутентификации
- [ ] Таймаут соединения
- [ ] Хост и порт Redis

### Вопрос 25
BackgroundTasks FastAPI запускает пост-обработку письма. Чем он отличается от APScheduler? Отметь все подходящие варианты.

- [ ] APScheduler требует явного вызова `scheduler.start()`
- [ ] BackgroundTasks выполняет задачи после ответа на конкретный запрос
- [ ] APScheduler запускает задачи по расписанию без привязки к запросу
- [ ] BackgroundTasks не подходит для периодических задач

### Вопрос 26
Нужно инжектировать конфигурацию приложения в несколько эндпоинтов. Какой подход масштабируется?

- [ ] Использовать глобальную переменную в модуле
- [ ] Читать файл конфигурации в каждом эндпоинте
- [ ] Создать зависимость `get_settings`, возвращающую объект настроек
- [ ] Передавать настройки через аргументы вручную

### Вопрос 27
Middleware проверяет заголовок `Authorization`. Какие шаги нужны, чтобы вернуть 401 при отсутствии токена? Отметь все подходящие варианты.

- [ ] При отсутствии токена вернуть `JSONResponse(status_code=401, content=...)` и вызвать `call_next`
- [ ] Считать заголовок из `request.headers`
- [ ] При отсутствии токена вернуть `JSONResponse(status_code=401, content=...)` без вызова `call_next`
- [ ] Пробрасывать запрос дальше без изменений

### Вопрос 28
Отчёт о популярных товарах пересчитывается бэкендом раз в час, но нужны актуальные данные. Какие подходы помогут балансировать скорость и актуальность? Отметь все подходящие варианты.

- [ ] Периодически пересчитывать и перезаписывать кеш
- [ ] Задать короткий TTL и инвалидацию по событию, когда источник данных обновляется
- [ ] Кешировать без TTL и не обновлять данные
- [ ] Использовать только TTL без событийной инвалидации

