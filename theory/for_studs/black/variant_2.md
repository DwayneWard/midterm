# Теоретическая часть контрольной работы
## Вариант 2

**Дисциплина:** Разработка на Python. Профессиональный

**Фамилия, Имя:** _________________________________

---

### Вопрос 1
Команда аналитики хранит агрегаты в Redis для панели «эффективность кампаний». Какой формат выбрать, чтобы фронтенд безболезненно парсил данные?

**Ответ:**

_________________________________


### Вопрос 2
Команда запускает Redis для кеша. Какой командой из CLI проверить, что сервис отвечает?

**Ответ:**

_________________________________


### Вопрос 3
API отдаёт курс валют, который обновляется каждую минуту. Какой TTL выбрать для кеша ответа?

- [ ] 60 секунд
- [ ] 10 минут
- [ ] 30 секунд
- [ ] Без TTL

### Вопрос 4
Middleware должен сделать доступным текущего пользователя всем зависимостям. Как реализовать передачу пользователя в зависимости?

- [ ] Сохранить пользователя в `request.app.state`
- [ ] Использовать сессию для хранения пользователя
- [ ] Сохранить объект пользователя в `request.state.user`
- [ ] Передать пользователя через заголовок `X-User-Data`

### Вопрос 5
Нужно добавить централизованное логирование длительности запроса. Какие шаги обязательны? Отметь все подходящие варианты.

- [ ] Получить время окончания после `call_next`
- [ ] Использовать `time.time()` только в конце обработки
- [ ] Зафиксировать время начала до `call_next`
- [ ] Логировать дельту и идентификатор запроса

### Вопрос 6
В сервисе появился middleware, который должен проставлять `request_id` для каждого входящего запроса. Где генерировать идентификатор?

- [ ] В конце middleware после получения ответа
- [ ] В начале middleware до вызова `call_next`
- [ ] В отдельном middleware, который выполняется первым
- [ ] В dependency injection через `Depends`

### Вопрос 7
Платформа рассылок кеширует статистику кампаний. Ключ должен учитывать `campaign_id`, `segment` и версию эксперимента. Какие данные нужно использовать в качестве ключа? Отметь все подходящие варианты.

- [ ] Версию API
- [ ] Важные query-параметры (`segment`, `variant`)
- [ ] JWT пользователя
- [ ] Путь запроса (`/campaigns`)

### Вопрос 8
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

- [ ] Создать зависимость `get_db` и использовать Depends, возвращая сессию
- [ ] Передавать подключения через аргументы эндпоинта
- [ ] Создавать соединение внутри эндпоинта через глобальную переменную
- [ ] Создать зависимость `get_cache` для Redis

### Вопрос 9
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

- [ ] Настроить `lifespan` для управления жизненным циклом
- [ ] Добавить задачу с `IntervalTrigger(minutes=15)`
- [ ] Создать `AsyncIOScheduler`
- [ ] Запустить `scheduler.start()`

### Вопрос 10
После запуска промо-кампании нужно быстро сбросить кеш конкретного сегмента. Какие подходы подходят? Отметь все подходящие варианты.

- [ ] Ждать истечения TTL без ручной инвалидации
- [ ] Использовать префикс `segment:<id>` и удалять через `SCAN`
- [ ] Хранить ключи сегмента в `SET` и удалять их
- [ ] Использовать `KEYS segment:<id>:*` и удалять найденные ключи

### Вопрос 11
Нужно проверить, сколько времени осталось до истечения ключа `segment:42`. Какие команды Redis помогут? Отметь все подходящие варианты.

- [ ] `PTTL segment:42`
- [ ] `EXPIRE segment:42 60`
- [ ] `TTL segment:42`
- [ ] `GET segment:42`

### Вопрос 12
Нужно передавать настройки приложения в зависимости. Какой подход обеспечит гибкость?

- [ ] Генерировать настройки на лету из запроса
- [ ] Хранить настройки в глобальной переменной модуля
- [ ] Читать `.env` файл внутри каждого эндпоинта
- [ ] Использовать `pydantic`-модель настроек и DI `get_settings()`

### Вопрос 13
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

- [ ] Добавить уведомления при исключениях
- [ ] Использовать `scheduler.shutdown()` при завершении приложения
- [ ] Оборачивать задачу в try/except
- [ ] Логировать ошибки

### Вопрос 14
В логах нужно видеть тело запроса. Какие меры нужны, чтобы не повредить работу приложения? Отметь все подходящие варианты.

- [ ] Использовать `request.json()` для чтения тела без сохранения
- [ ] Ограничить размер логируемого тела
- [ ] Фильтровать чувствительные поля перед логированием
- [ ] Считывать тело через `await request.body()` и записывать обратно в `request._body`

### Вопрос 15
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

- [ ] Использовать общий форматтер для всех логгеров через `basicConfig`
- [ ] Настроить `logging.dictConfig` с общим форматтером
- [ ] Использовать `structlog` или собственный адаптер
- [ ] Настроить `LoggerAdapter`, который добавляет контекст

### Вопрос 16
JSON-ответ весит 5 МБ, и логирование всех примеров перегружает диск. Что нужно сделать? Отметь все подходящие варианты.

- [ ] Писать логи в файл и удалять их вручную
- [ ] Ограничить размер записей через фильтр логирования
- [ ] Перевести формат логов на JSON и писать в stdout
- [ ] Добавить троттлинг логов по количеству

### Вопрос 17
Middleware проверяет токен доступа для private API. Что произойдёт, если вызвать `call_next` и только потом проверить токен?

- [ ] Пользователь увидит 401 до выполнения эндпоинта
- [ ] FastAPI автоматически прервёт обработку при ошибке
- [ ] Эндпоинт выполнится, даже если токен недействителен
- [ ] Токен будет проверен дважды: в middleware и в эндпоинте

### Вопрос 18
Обновление каталога товаров требует очистить связанные кеш-ключи. Какие подходы подходят? Отметь все подходящие варианты.

- [ ] Использовать префикс `catalog:*` и удалять через `SCAN`
- [ ] Ждать истечения TTL
- [ ] Использовать `KEYS catalog:*` и удалять найденные ключи
- [ ] Хранить ключи каталога в `SET` и удалять их

### Вопрос 19
Логи нужно связать с конкретной операцией пользователя. Какие поля нужно включить в формат? Отметь все подходящие варианты.

- [ ] `message`
- [ ] `user_id`
- [ ] `timestamp`
- [ ] `request_id`

### Вопрос 20
Нужно поддерживать актуальность дэшборда «онлайн-конверсии». Какие приёмы помогут балансировать стоимость пересчёта и актуальность? Отметь все подходящие варианты.

- [ ] Хранить отчёты без TTL
- [ ] Инвалидировать кеш по вебхуку из основной БД
- [ ] Использовать короткий TTL и обновлять кеш в фоне перед истечением
- [ ] Выдавать кеш и параллельно запускать пересчёт (stale-while-revalidate)

### Вопрос 21
Перед отправкой кампаний QA проверяет архитектуру кеша. Какие элементы должен включать общий helper? Отметь все подходящие варианты.

- [ ] Зависимость, которая проверяет Redis перед выполнением бизнес-логики
- [ ] Функцию сериализации/десериализации ответа
- [ ] Обработку ошибок при работе с Redis
- [ ] Сигнал на удаление кеша после записи в БД

### Вопрос 22
Чем `BackgroundTasks` удобен по сравнению с APScheduler для отправки email после запроса?

**Ответ:**

_________________________________


### Вопрос 23
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?

**Ответ:**

_________________________________


### Вопрос 24
Какой уровень логирования использовать для сообщения об ошибке валидации входных данных?

- [ ] WARNING
- [ ] INFO
- [ ] DEBUG
- [ ] ERROR

### Вопрос 25
Нужно гарантировать, что фоновые задачи не остановятся при перезапуске приложения. Что нужно сделать? Отметь все подходящие варианты.

- [ ] Запускать APScheduler в отдельном процессе или сервисе
- [ ] Настроить `lifespan` для управления жизненным циклом
- [ ] Использовать persistent job store (например, Redis)
- [ ] Использовать `scheduler.shutdown()` при завершении приложения

### Вопрос 26
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

- [ ] Проверять ключ внутри каждого эндпоинта
- [ ] Хранить ключ в глобальной переменной без проверки
- [ ] Использовать middleware без проверки ключа
- [ ] Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии

### Вопрос 27
Нужно, чтобы все ответы API содержали заголовок `X-Trace-Id`. Какие действия нужны в middleware? Отметь все подходящие варианты.

- [ ] Вызвать `response = await call_next(request)`
- [ ] Создать или взять `trace_id` из запроса
- [ ] Добавить заголовок в `request.headers` до вызова `call_next`
- [ ] Добавить заголовок `response.headers["X-Trace-Id"] = trace_id`

### Вопрос 28
Зачем использовать DI при поддержке больших приложений? Отметь все подходящие варианты.

- [ ] Можно подключать разные реализации сервисов в зависимости от окружения
- [ ] Проще контролировать жизненный цикл ресурсов (открытие/закрытие соединений)
- [ ] Зависимости можно централизованно обновлять и рефакторить без правок во всех эндпоинтах
- [ ] Упрощает тестирование за счёт возможности подмены зависимостей

