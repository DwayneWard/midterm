# Теоретическая часть контрольной работы
## Вариант 5

**Дисциплина:** Разработка на Python. Профессиональный

**Фамилия, Имя:** _________________________________

---

### Вопрос 1
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?

**Ответ:**

_________________________________


### Вопрос 2
Как передавать настройки приложения в зависимости?

- [ ] Передавать конфигурацию как query-параметр
- [ ] Читать конфигурацию в каждом эндпоинте
- [ ] Использовать `pydantic`-модель `Settings` и внедрять через зависимость
- [ ] Хранить настройки в глобальной переменной модуля

### Вопрос 3
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

- [ ] Оборачивать задачу в try/except
- [ ] Использовать `scheduler.shutdown()` при завершении приложения
- [ ] Добавить уведомления при исключениях
- [ ] Логировать ошибки

### Вопрос 4
Создаётся обёртка над кешем. Что нужно включить? Отметь все подходящие варианты.

- [ ] Инвалидацию при критических событиях
- [ ] Обработку ошибок при работе с Redis
- [ ] Сериализацию/десериализацию
- [ ] Генерацию ключей

### Вопрос 5
Кеш возвращает устаревшие данные. Какие причины возможны? Отметь все подходящие варианты.

- [ ] Неправильно настроенный TTL
- [ ] Несогласованные ключи между инстансами
- [ ] Кеш не был обновлён после изменения данных в источнике
- [ ] Данные в источнике обновились без инвалидации

### Вопрос 6
Логи перезаполняют хранилище. Какие поля стоит оставлять в структурированном логе? Отметь все подходящие варианты.

- [ ] `message`
- [ ] `path`
- [ ] `status_code`
- [ ] `request_id`

### Вопрос 7
Чем отличается `BackgroundTasks` от APScheduler? Отметь все подходящие варианты.

- [ ] APScheduler требует явного вызова `scheduler.start()`
- [ ] APScheduler выполняет задачи по расписанию
- [ ] `BackgroundTasks` запускают операции сразу после ответа
- [ ] `BackgroundTasks` привязаны к конкретному запросу

### Вопрос 8
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

- [ ] Создать middleware, которое добавляет формат каждому сообщению
- [ ] Настроить общий форматтер и подключить его ко всем логгерам
- [ ] Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст
- [ ] Использовать общий форматтер для всех логгеров через `basicConfig`

### Вопрос 9
Как узнать остаток TTL ключа `analytics:data`?

- [ ] `PTTL analytics:data`
- [ ] `GET analytics:data`
- [ ] `TTL analytics:data`
- [ ] `EXPIRE analytics:data 60`

### Вопрос 10
Почему DI упрощает поддержку сервисов? Отметь все подходящие варианты.

- [ ] Легко подменять реализации сервисов
- [ ] Удобно подключать заглушки для тестов
- [ ] Централизовать управление ресурсами
- [ ] Упрощает рефакторинг зависимостей без изменения всех эндпоинтов

### Вопрос 11
Ключ кеша должен включать тип отчёта и дату. Как его оформить, чтобы команда понимала структуру?

**Ответ:**

_________________________________


### Вопрос 12
Нужно добавить заголовок `X-App-Region` во все ответы. Какие шаги нужны в middleware? Отметь все подходящие варианты.

- [ ] Вызвать `response = await call_next(request)`
- [ ] Получить значение региона из настроек
- [ ] Добавить заголовок в `request.headers` до вызова `call_next`
- [ ] Добавить заголовок в `response.headers`

### Вопрос 13
Как сохранить расписание задач при рестарте?

- [ ] Использовать `scheduler.shutdown()` при завершении приложения
- [ ] Запускать APScheduler отдельно от веб-приложения
- [ ] Настроить `lifespan` для управления жизненным циклом
- [ ] Использовать persistent job store (например, Redis, Б
- [ ] 

### Вопрос 14
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

- [ ] Проверять ключ внутри каждого эндпоинта
- [ ] Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
- [ ] Использовать middleware без проверки ключа
- [ ] Хранить ключ в глобальной переменной без проверки

### Вопрос 15
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

- [ ] Создать зависимость `get_cache` для Redis
- [ ] Создать зависимость `get_db` и использовать Depends, возвращая сессию
- [ ] Создавать соединение внутри эндпоинта через глобальную переменную
- [ ] Передавать подключения через аргументы эндпоинта

### Вопрос 16
Отчёт строится раз в час и дорог по ресурсам. Как балансировать свежесть и производительность? Отметь все подходящие варианты.

- [ ] Использовать только TTL без фонового обновления
- [ ] Инвалидировать кеш при обновлении данных
- [ ] Кешировать отчёт, обновляя кеш фоновыми задачами заранее
- [ ] Кешировать отчёт с очень коротким TTL (несколько минут)

### Вопрос 17
На каком уровне логировать повторяющиеся вопросы пользователей в саппорте (не критично, но требует внимания)?

- [ ] ERROR
- [ ] WARNING
- [ ] DEBUG
- [ ] INFO

### Вопрос 18
В middleware используется `time.sleep(2)` для задержки. Что произойдёт с производительностью приложения?

- [ ] Задержка повлияет только на текущий запрос, другие продолжат обрабатываться
- [ ] Event Loop заблокируется, и все запросы будут обрабатываться последовательно
- [ ] FastAPI автоматически вынесет операцию в thread pool executor
- [ ] Задержка выполнится асинхронно через `asyncio.sleep` и не повлияет на другие запросы

### Вопрос 19
Эндпоинт `/stats` обновляет данные каждые 3 минуты. Какой TTL выбрать?

- [ ] 30 минут
- [ ] Без TTL
- [ ] 10 секунд
- [ ] 3 минуты

### Вопрос 20
Redis выступает кешем для конфигурации. Какие параметры клиента важны? Отметь все подходящие варианты.

- [ ] Таймаут подключения
- [ ] Пароль для аутентификации
- [ ] Таймаут команд
- [ ] Количество переподключений

### Вопрос 21
Middleware кладёт `user` в `request.state`. Как безопасно получить значение в зависимости?

- [ ] Использовать `request.app.state.user` для хранения пользователя
- [ ] Прочитать `request.state.user`, проверив наличие атрибута
- [ ] Читать пользователя из `request.headers.get("X-User")`
- [ ] Использовать dependency injection без проверки наличия пользователя

### Вопрос 22
Как сбросить кеш конкретного пользователя при изменении его профиля?

- [ ] Обновлять кеш только при следующем запросе
- [ ] Использовать `KEYS user:<id>:*` и удалять найденные ключи
- [ ] Хранить ключи пользователя в `SET` и удалять при обновлении
- [ ] Удалять все ключи по префиксу через `SCAN`

### Вопрос 23
Middleware логирует тело ответа. Как избежать повреждения ответа?

- [ ] Использовать `response.body_iterator` напрямую без копирования
- [ ] Использовать `response.body` без создания нового `Response`
- [ ] Скопировать тело, логировать копию и вернуть новый `Response` с исходным содержимым
- [ ] Логировать только заголовки ответа

### Вопрос 24
Логи должны позволять восстановить ход запроса пользователя. Какие поля добавить? Отметь все подходящие варианты.

- [ ] `user_id`
- [ ] `message`
- [ ] `level`
- [ ] `timestamp`

### Вопрос 25
Подключается middleware, которое должно проставлять `request_id` и сохранять его для логов. Где оформить генерацию идентификатора?

- [ ] В dependency injection через `Depends`
- [ ] В отдельном middleware, который выполняется последним
- [ ] До вызова `call_next`, чтобы `request_id` был доступен всем downstream-обработчикам
- [ ] После возвращения ответа

### Вопрос 26
Как удалить кеш при обновлении товара? Какую команду Redis использовать?

**Ответ:**

_________________________________


### Вопрос 27
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

- [ ] Создать `AsyncIOScheduler`
- [ ] Добавить задачу с `IntervalTrigger(minutes=15)`
- [ ] Запустить `scheduler.start()`
- [ ] Настроить `lifespan` для управления жизненным циклом

### Вопрос 28
Нужно собирать метрику времени обработки. Что записывать? Отметь все подходящие варианты.

- [ ] Timestamp окончания
- [ ] Timestamp старта
- [ ] Количество активных соединений
- [ ] Длительность

