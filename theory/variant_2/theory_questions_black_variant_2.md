# Теоретическая часть контрольной работы. Вариант 2
## Разработка на Python. Профессиональный

### Вопрос 1
Команда аналитики хранит агрегаты в Redis для панели «эффективность кампаний». Какой формат выбрать, чтобы фронтенд безболезненно парсил данные?
**Правильный ответ:** JSON-строка (принимаются варианты с `json.dumps`)
**Проверяемый ОР:** Понимает. - Почему Redis популярен как хранилище кеша и как выбирать формат данных.



### Вопрос 2
Команда запускает Redis для кеша. Какой командой из CLI проверить, что сервис отвечает?

**Правильный ответ:** `redis-cli PING`

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).



### Вопрос 3
API отдаёт курс валют, который обновляется каждую минуту. Какой TTL выбрать для кеша ответа?

А) 60 секунд
Б) 10 минут
В) 30 секунд
Г) Без TTL

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.



### Вопрос 4
Middleware должен сделать доступным текущего пользователя всем зависимостям. Как реализовать передачу пользователя в зависимости?

А) Сохранить пользователя в `request.app.state`
Б) Использовать сессию для хранения пользователя
В) Сохранить объект пользователя в `request.state.user`
Г) Передать пользователя через заголовок `X-User-Data`

**Правильный ответ:** В

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 5
Нужно добавить централизованное логирование длительности запроса. Какие шаги обязательны? Отметь все подходящие варианты.

А) Получить время окончания после `call_next`
Б) Использовать `time.time()` только в конце обработки
В) Зафиксировать время начала до `call_next`
Г) Логировать дельту и идентификатор запроса

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.



### Вопрос 6
В сервисе появился middleware, который должен проставлять `request_id` для каждого входящего запроса. Где генерировать идентификатор?

А) В конце middleware после получения ответа
Б) В начале middleware до вызова `call_next`
В) В отдельном middleware, который выполняется первым
Г) В dependency injection через `Depends`

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 7
Платформа рассылок кеширует статистику кампаний. Ключ должен учитывать `campaign_id`, `segment` и версию эксперимента. Какие данные нужно использовать в качестве ключа? Отметь все подходящие варианты.
А) Версию API
Б) Важные query-параметры (`segment`, `variant`)
В) JWT пользователя
Г) Путь запроса (`/campaigns`)

**Правильные ответы:** А, Б, Г
**Проверяемый ОР:** Понимает. - Какие данные лучше кешировать, а какие — нет.



### Вопрос 8
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения? Отметь все подходящие варианты.

А) Создать зависимость `get_db` и использовать Depends, возвращая сессию
Б) Передавать подключения через аргументы эндпоинта
В) Создавать соединение внутри эндпоинта через глобальную переменную
Г) Создать зависимость `get_cache` для Redis

**Правильные ответы:** А, Г

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.



### Вопрос 9
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Настроить `lifespan` для управления жизненным циклом
Б) Добавить задачу с `IntervalTrigger(minutes=15)`
В) Создать `AsyncIOScheduler`
Г) Запустить `scheduler.start()`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.



### Вопрос 10
После запуска промо-кампании нужно быстро сбросить кеш конкретного сегмента. Какие подходы подходят? Отметь все подходящие варианты.
А) Ждать истечения TTL без ручной инвалидации
Б) Использовать префикс `segment:<id>` и удалять через `SCAN`
В) Хранить ключи сегмента в `SET` и удалять их
Г) Использовать `KEYS segment:<id>:*` и удалять найденные ключи

**Правильные ответы:** Б, В
**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 11
Нужно проверить, сколько времени осталось до истечения ключа `segment:42`. Какие команды Redis помогут? Отметь все подходящие варианты.
А) `PTTL segment:42`
Б) `EXPIRE segment:42 60`
В) `TTL segment:42`
Г) `GET segment:42`

**Правильные ответы:** А, В
**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.



### Вопрос 12
Нужно передавать настройки приложения в зависимости. Какой подход обеспечит гибкость?

А) Генерировать настройки на лету из запроса
Б) Хранить настройки в глобальной переменной модуля
В) Читать `.env` файл внутри каждого эндпоинта
Г) Использовать `pydantic`-модель настроек и DI `get_settings()`

**Правильный ответ:** Г

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.



### Вопрос 13
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься? Отметь все подходящие варианты.

А) Добавить уведомления при исключениях
Б) Использовать `scheduler.shutdown()` при завершении приложения
В) Оборачивать задачу в try/except
Г) Логировать ошибки

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.



### Вопрос 14
В логах нужно видеть тело запроса. Какие меры нужны, чтобы не повредить работу приложения? Отметь все подходящие варианты.

А) Использовать `request.json()` для чтения тела без сохранения
Б) Ограничить размер логируемого тела
В) Фильтровать чувствительные поля перед логированием
Г) Считывать тело через `await request.body()` и записывать обратно в `request._body`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 15
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Использовать общий форматтер для всех логгеров через `basicConfig`
Б) Настроить `logging.dictConfig` с общим форматтером
В) Использовать `structlog` или собственный адаптер
Г) Настроить `LoggerAdapter`, который добавляет контекст

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 16
JSON-ответ весит 5 МБ, и логирование всех примеров перегружает диск. Что нужно сделать? Отметь все подходящие варианты.

А) Писать логи в файл и удалять их вручную
Б) Ограничить размер записей через фильтр логирования
В) Перевести формат логов на JSON и писать в stdout
Г) Добавить троттлинг логов по количеству

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 17
Middleware проверяет токен доступа для private API. Что произойдёт, если вызвать `call_next` и только потом проверить токен?

А) Пользователь увидит 401 до выполнения эндпоинта
Б) FastAPI автоматически прервёт обработку при ошибке
В) Эндпоинт выполнится, даже если токен недействителен
Г) Токен будет проверен дважды: в middleware и в эндпоинте

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Почему middleware полезен для централизованной обработки запросов.



### Вопрос 18
Обновление каталога товаров требует очистить связанные кеш-ключи. Какие подходы подходят? Отметь все подходящие варианты.

А) Использовать префикс `catalog:*` и удалять через `SCAN`
Б) Ждать истечения TTL
В) Использовать `KEYS catalog:*` и удалять найденные ключи
Г) Хранить ключи каталога в `SET` и удалять их

**Правильные ответы:** А, Г

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.


### Вопрос 19
Логи нужно связать с конкретной операцией пользователя. Какие поля нужно включить в формат? Отметь все подходящие варианты.

А) `message`
Б) `user_id`
В) `timestamp`
Г) `request_id`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.



### Вопрос 20
Нужно поддерживать актуальность дэшборда «онлайн-конверсии». Какие приёмы помогут балансировать стоимость пересчёта и актуальность? Отметь все подходящие варианты.
А) Хранить отчёты без TTL
Б) Инвалидировать кеш по вебхуку из основной БД
В) Использовать короткий TTL и обновлять кеш в фоне перед истечением
Г) Выдавать кеш и параллельно запускать пересчёт (stale-while-revalidate)

**Правильные ответы:** Б, Г
**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 21
Перед отправкой кампаний QA проверяет архитектуру кеша. Какие элементы должен включать общий helper? Отметь все подходящие варианты.
А) Зависимость, которая проверяет Redis перед выполнением бизнес-логики
Б) Функцию сериализации/десериализации ответа
В) Обработку ошибок при работе с Redis
Г) Сигнал на удаление кеша после записи в БД

**Правильные ответы:** А, Б, Г
**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.



### Вопрос 22
Чем `BackgroundTasks` удобен по сравнению с APScheduler для отправки email после запроса?

**Правильный ответ:** Он привязан к конкретному запросу и запускает задачу сразу после формирования ответа (принимаются эквиваленты)

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.



### Вопрос 23
Какой уровень логирования использовать для сообщения об ошибке валидации входных данных?

А) WARNING
Б) INFO
В) DEBUG
Г) ERROR

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.



### Вопрос 24
Нужно гарантировать, что фоновые задачи не остановятся при перезапуске приложения. Что нужно сделать? Отметь все подходящие варианты.

А) Запускать APScheduler в отдельном процессе или сервисе
Б) Настроить `lifespan` для управления жизненным циклом
В) Использовать persistent job store (например, Redis)
Г) Использовать `scheduler.shutdown()` при завершении приложения

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.



### Вопрос 25
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Проверять ключ внутри каждого эндпоинта
Б) Хранить ключ в глобальной переменной без проверки
В) Использовать middleware без проверки ключа
Г) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии

**Правильный ответ:** Г

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.



### Вопрос 26
Нужно, чтобы все ответы API содержали заголовок `X-Trace-Id`. Какие действия нужны в middleware? Отметь все подходящие варианты.

А) Вызвать `response = await call_next(request)`
Б) Создать или взять `trace_id` из запроса
В) Добавить заголовок в `request.headers` до вызова `call_next`
Г) Добавить заголовок `response.headers["X-Trace-Id"] = trace_id`

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 27
Зачем использовать DI при поддержке больших приложений? Отметь все подходящие варианты.

А) Можно подключать разные реализации сервисов в зависимости от окружения
Б) Проще контролировать жизненный цикл ресурсов (открытие/закрытие соединений)
В) Зависимости можно централизованно обновлять и рефакторить без правок во всех эндпоинтах
Г) Упрощает тестирование за счёт возможности подмены зависимостей

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.

