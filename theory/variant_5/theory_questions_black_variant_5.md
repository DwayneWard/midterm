# Теоретическая часть контрольной работы. Вариант 5
## Разработка на Python. Профессиональный

### Вопрос 1
Как передавать настройки приложения в зависимости?

А) Передавать конфигурацию как query-параметр
Б) Читать конфигурацию в каждом эндпоинте
В) Использовать `pydantic`-модель `Settings` и внедрять через зависимость
Г) Хранить настройки в глобальной переменной модуля

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.



### Вопрос 2
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься? Отметь все подходящие варианты.

А) Оборачивать задачу в try/except
Б) Использовать `scheduler.shutdown()` при завершении приложения
В) Добавить уведомления при исключениях
Г) Логировать ошибки

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.



### Вопрос 3
Создаётся обёртка над кешем. Что нужно включить? Отметь все подходящие варианты.

А) Инвалидацию при критических событиях
Б) Обработку ошибок при работе с Redis
В) Сериализацию/десериализацию
Г) Генерацию ключей

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.



### Вопрос 4
Кеш возвращает устаревшие данные. Какие причины возможны? Отметь все подходящие варианты.

А) Неправильно настроенный TTL
Б) Несогласованные ключи между инстансами
В) Кеш не был обновлён после изменения данных в источнике
Г) Данные в источнике обновились без инвалидации

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 5
Логи перезаполняют хранилище. Какие поля стоит оставлять в структурированном логе? Отметь все подходящие варианты.

А) `message`
Б) `path`
В) `status_code`
Г) `request_id`

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 6
Чем отличается `BackgroundTasks` от APScheduler? Отметь все подходящие варианты.

А) APScheduler требует явного вызова `scheduler.start()`
Б) APScheduler выполняет задачи по расписанию
В) `BackgroundTasks` запускают операции сразу после ответа
Г) `BackgroundTasks` привязаны к конкретному запросу

**Правильные ответы:** Б, В, Г

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.



### Вопрос 7
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Создать middleware, которое добавляет формат каждому сообщению
Б) Настроить общий форматтер и подключить его ко всем логгерам
В) Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст
Г) Использовать общий форматтер для всех логгеров через `basicConfig`

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.



### Вопрос 8
Как узнать остаток TTL ключа `analytics:data`? Отметь все подходящие варианты.

А) `PTTL analytics:data`
Б) `GET analytics:data`
В) `TTL analytics:data`
Г) `EXPIRE analytics:data 60`

**Правильные ответы:** А, В

**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.



### Вопрос 9
Почему DI упрощает поддержку сервисов? Отметь все подходящие варианты.

А) Легко подменять реализации сервисов
Б) Удобно подключать заглушки для тестов
В) Централизовать управление ресурсами
Г) Упрощает рефакторинг зависимостей без изменения всех эндпоинтов

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.



### Вопрос 10
Ключ кеша должен включать тип отчёта и дату. Как его оформить, чтобы команда понимала структуру?

**Правильный ответ:** Например, `f"report:{report_type}:{date}"` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения и как структурировать ключи.



### Вопрос 11
Нужно добавить заголовок `X-App-Region` во все ответы. Какие шаги нужны в middleware? Отметь все подходящие варианты.

А) Вызвать `response = await call_next(request)`
Б) Получить значение региона из настроек
В) Добавить заголовок в `request.headers` до вызова `call_next`
Г) Добавить заголовок в `response.headers`

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 12
Как сохранить расписание задач при рестарте? Отметь все подходящие варианты.

А) Использовать `scheduler.shutdown()` при завершении приложения
Б) Запускать APScheduler отдельно от веб-приложения
В) Настроить `lifespan` для управления жизненным циклом
Г) Использовать persistent job store (например, Redis, БД)

**Правильные ответы:** Б, Г

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.



### Вопрос 13
Нужно ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Проверять ключ внутри каждого эндпоинта
Б) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии
В) Использовать middleware без проверки ключа
Г) Хранить ключ в глобальной переменной без проверки

**Правильный ответ:** Б

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.



### Вопрос 14
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения? Отметь все подходящие варианты.

А) Создать зависимость `get_cache` для Redis
Б) Создать зависимость `get_db` и использовать Depends, возвращая сессию
В) Создавать соединение внутри эндпоинта через глобальную переменную
Г) Передавать подключения через аргументы эндпоинта

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.



### Вопрос 15
Отчёт строится раз в час и дорог по ресурсам. Как балансировать свежесть и производительность? Отметь все подходящие варианты.

А) Использовать только TTL без фонового обновления
Б) Инвалидировать кеш при обновлении данных
В) Кешировать отчёт, обновляя кеш фоновыми задачами заранее
Г) Кешировать отчёт с очень коротким TTL (несколько минут)

**Правильные ответы:** Б, В

**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.



### Вопрос 16
На каком уровне логировать повторяющиеся вопросы пользователей в саппорте (не критично, но требует внимания)?

А) ERROR
Б) WARNING
В) DEBUG
Г) INFO

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.



### Вопрос 17
В middleware используется `time.sleep(2)` для задержки. Что произойдёт с производительностью приложения?

А) Задержка повлияет только на текущий запрос, другие продолжат обрабатываться
Б) Event Loop заблокируется, и все запросы будут обрабатываться последовательно
В) FastAPI автоматически вынесет операцию в thread pool executor
Г) Задержка выполнится асинхронно через `asyncio.sleep` и не повлияет на другие запросы

**Правильный ответ:** Б

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 18
Эндпоинт `/stats` обновляет данные каждые 3 минуты. Какой TTL выбрать?

А) 30 минут
Б) Без TTL
В) 10 секунд
Г) 3 минуты

**Правильный ответ:** Г

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.



### Вопрос 19
Redis выступает кешем для конфигурации. Какие параметры клиента важны? Отметь все подходящие варианты.

А) Таймаут подключения
Б) Пароль для аутентификации
В) Таймаут команд
Г) Количество переподключений

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).



### Вопрос 20
Middleware кладёт `user` в `request.state`. Как безопасно получить значение в зависимости?

А) Использовать `request.app.state.user` для хранения пользователя
Б) Прочитать `request.state.user`, проверив наличие атрибута
В) Читать пользователя из `request.headers.get("X-User")`
Г) Использовать dependency injection без проверки наличия пользователя

**Правильный ответ:** Б

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.



### Вопрос 21
Как сбросить кеш конкретного пользователя при изменении его профиля? Отметь все подходящие варианты.

А) Обновлять кеш только при следующем запросе
Б) Использовать `KEYS user:<id>:*` и удалять найденные ключи
В) Хранить ключи пользователя в `SET` и удалять при обновлении
Г) Удалять все ключи по префиксу через `SCAN`

**Правильные ответы:** В, Г

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 22
Middleware логирует тело ответа. Как избежать повреждения ответа?

А) Использовать `response.body_iterator` напрямую без копирования
Б) Использовать `response.body` без создания нового `Response`
В) Скопировать тело, логировать копию и вернуть новый `Response` с исходным содержимым
Г) Логировать только заголовки ответа

**Правильный ответ:** В

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.



### Вопрос 23
Логи должны позволять восстановить ход запроса пользователя. Какие поля добавить? Отметь все подходящие варианты.

А) `user_id`
Б) `message`
В) `level`
Г) `timestamp`

**Правильные ответы:** А, В, Г

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.



### Вопрос 24
Подключается middleware, которое должно проставлять `request_id` и сохранять его для логов. Где оформить генерацию идентификатора?

А) В dependency injection через `Depends`
Б) В отдельном middleware, который выполняется последним
В) До вызова `call_next`, чтобы `request_id` был доступен всем downstream-обработчикам
Г) После возвращения ответа

**Правильный ответ:** В

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.



### Вопрос 25
Как удалить кеш при обновлении товара? Какую команду Redis использовать?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.



### Вопрос 26
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Создать `AsyncIOScheduler`
Б) Добавить задачу с `IntervalTrigger(minutes=15)`
В) Запустить `scheduler.start()`
Г) Настроить `lifespan` для управления жизненным циклом

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.



### Вопрос 27
Нужно собирать метрику времени обработки. Что записывать? Отметь все подходящие варианты.

А) Timestamp окончания
Б) Timestamp старта
В) Количество активных соединений
Г) Длительность

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.

