# Теоретическая часть контрольной работы. Вариант 5
## Разработка на Python. Профессиональный

### Вопрос 1
Ты подключаешь middleware, которое должно проставлять `request_id` и сохранять его для логов. Где оформить генерацию идентификатора?

А) До вызова `call_next`, чтобы `request_id` был доступен всем downstream-обработчикам  
Б) После возвращения ответа  
В) В каждом эндпоинте вручную  
Г) В отдельном background task

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.

### Вопрос 2
Нужно добавить заголовок `X-App-Region` во все ответы. Какие шаги предпримешь в middleware? Отметь все подходящие варианты.

А) Получить значение региона из настроек  
Б) Вызвать `response = await call_next(request)`  
В) Добавить заголовок в `response.headers`  
Г) Вернуть `None`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 3
Middleware фильтрует запросы по IP. Как правильно использовать список разрешённых адресов?

А) Получить его из настроек при старте и хранить в памяти  
Б) Читать файл со списком при каждом запросе  
В) Использовать глобальную переменную без синхронизации  
Г) Игнорировать список

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Почему middleware полезен для централизованной обработки запросов.

### Вопрос 4
Middleware логирует тело ответа. Как избежать повреждения ответа?

А) Скопировать тело, логировать копию и вернуть новый `Response` с исходным содержимым  
Б) Использовать `print(response)`  
В) Логировать только заголовки  
Г) Отключить логирование

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.

### Вопрос 5
Middleware кладёт `user` в `request.state`. Как безопасно получить значение в зависимости?

А) Прочитать `request.state.user`, проверив наличие атрибута  
Б) Взять пользователя из глобальной переменной  
В) Использовать `request.headers["user"]`  
Г) Принять, что `user` всегда есть

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 6
Нужно собирать метрику времени обработки. Что записывать? Отметь все подходящие варианты.

А) Timestamp старта  
Б) Timestamp окончания  
В) Длительность  
Г) Название ветки Git

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.

### Вопрос 7
Redis выступает кешем для конфигурации. Какие параметры клиента важны? Отметь все подходящие варианты.

А) Таймаут подключения  
Б) Таймаут команд  
В) Количество переподключений  
Г) Цвет интерфейса

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).

### Вопрос 8
Эндпоинт `/stats` обновляет данные каждые 3 минуты. Какой TTL выберешь?

А) 3 минуты  
Б) 10 секунд  
В) 30 минут  
Г) Без TTL

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.

### Вопрос 9
Ключ кеша должен включать тип отчёта и дату. Как его оформить, чтобы команда понимала структуру?

**Правильный ответ:** Например, `f"report:{report_type}:{date}"` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения и как структурировать ключи.

### Вопрос 10
Кеш возвращает устаревшие данные. Какие причины возможны? Отметь все подходящие варианты.

А) Данные в источнике обновились без инвалидации  
Б) Несогласованные ключи между инстансами  
В) Неправильно настроенный TTL  
Г) Клиент перешёл на другую страницу

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 11
Как сбросить кеш конкретного пользователя при изменении его профиля?

А) Хранить ключи пользователя в `SET` и удалять при обновлении  
Б) Удалять все ключи по префиксу через `SCAN`  
В) Выполнить `FLUSHALL`  
Г) Игнорировать изменения

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 12
Отчёт строится раз в час и дорог по ресурсам. Как балансировать свежесть и производительность? Отметь все подходящие варианты.

А) Кешировать отчёт, обновляя кеш фоновыми задачами заранее  
Б) Инвалидировать кеш при обновлении данных  
В) Полностью отказаться от кеша  
Г) Ограничить пользователей в доступе

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.

### Вопрос 13
Как узнать остаток TTL ключа `analytics:data`?

А) `TTL analytics:data`  
Б) `PTTL analytics:data`  
В) `EXPIRE analytics:data 0`  
Г) `RENAMENX analytics:data`

**Правильные ответы:** А, Б

**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.

### Вопрос 14
Ты создаёшь обёртку над кешем. Что включить? Отметь все подходящие варианты.

А) Генерацию ключей  
Б) Сериализацию/десериализацию  
В) Инвалидацию при критических событиях  
Г) Удаление таблиц БД

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.

### Вопрос 15
Логи перезаполняют хранилище. Какие поля стоит оставлять в структурированном логе? Отметь все подходящие варианты.

А) `request_id`  
Б) `path`  
В) `status_code`  
Г) `python_version`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 16
На каком уровне логировать повторяющиеся вопросы пользователей в саппорте (не критично, но требует внимания)?

А) INFO  
Б) DEBUG  
В) WARNING  
Г) ERROR

**Правильный ответ:** В

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.

### Вопрос 17
Логи должны позволять восстановить ход запроса пользователя. Какие поля добавить? Отметь все подходящие варианты.

А) `timestamp`  
Б) `level`  
В) `user_id`  
Г) `random`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.

### Вопрос 18
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Настроить общий форматтер и подключить его ко всем логгерам  
Б) Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст  
В) Писать логи через `print`  
Г) Создать middleware, которое добавляет формат каждому сообщению

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 19
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Создать `AsyncIOScheduler`  
Б) Добавить задачу с `trigger='interval', minutes=15`  
В) Запустить `scheduler.start()`  
Г) Запустить `scheduler.stop()`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.

### Вопрос 20
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

А) Оборачивать задачу в try/except  
Б) Добавить уведомления при исключениях  
В) Ничего не нужно делать, задача перезапустится автоматически  
Г) Логировать ошибки

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.

### Вопрос 21
Чем отличается `BackgroundTasks` от APScheduler? Отметь все подходящие варианты.

А) `BackgroundTasks` запускают операции сразу после ответа  
Б) APScheduler выполняет задачи по расписанию  
В) `BackgroundTasks` привязаны к конкретному запросу  
Г) APScheduler не работает с асинхронными задачами

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.

### Вопрос 22
Как сохранить расписание задач при рестарте?

А) Использовать persistent job store (например, Redis, БД)  
Б) Запускать APScheduler отдельно от веб-приложения  
В) Использовать только память процесса  
Г) Надеяться на автоматическое восстановление

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.

### Вопрос 23
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

А) Создать зависимость `get_db` и использовать Depends, возвращая сессию  
Б) Создать зависимость `get_cache` для Redis  
В) Создавать соединение внутри эндпоинта через глобальную переменную  
Г) Передавать подключения через аргументы эндпоинта

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.

### Вопрос 24
Почему DI упрощает поддержку сервисов? Отметь все подходящие варианты.

А) Легко подменять реализации сервисов  
Б) Централизовать управление ресурсами  
В) Удобно подключать заглушки для тестов  
Г) Уменьшает использование CPU

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.

### Вопрос 25
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?
```python
async def get_redis():
    async with aioredis.from_url(URL) as conn:
        yield conn
```
(принимаются эквиваленты с `yield`)
**Проверяемый ОР:** Понимает. - Как асинхронные зависимости улучшают производительность приложения.

### Вопрос 26
Ты хочешь ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии  
Б) Проверять ключ внутри каждого эндпоинта  
В) Хранить ключ в глобальной переменной без проверки  
Г) Передавать ключ через swagger

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.

### Вопрос 27
В каком порядке выполняются middleware и зависимости?

А) Middleware оборачивает запрос до вызова зависимостей  
Б) Зависимости выполняются до middleware  
В) Порядок случайный  
Г) Middleware не применяется к GET

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 28
Как передавать настройки приложения в зависимости?

А) Использовать `pydantic`-модель `Settings` и внедрять через зависимость  
Б) Читать конфигурацию в каждом эндпоинте  
В) Передавать конфигурацию как query-параметр  
Г) Прокидывать через глобальные переменные

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.

### Вопрос 29
Нужно логировать `request_id` в каждом сообщении без явного указания. Как комбинировать middleware и logging?

А) Middleware сохраняет `request_id` в `contextvars`, логгер использует фильтр/адаптер  
Б) Добавлять `request_id` вручную в каждой строке  
В) Настроить `LoggerAdapter`, который подмешивает поле  
Г) Отключить контекст ради производительности

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 30
Кеш должен срабатывать до бизнес-логики. Какой пайплайн?

А) Middleware проверяет кеш, кладёт данные в `request.state`; зависимость считывает данные или обращается в сервис  
Б) Кеш вызывается после завершения бизнес-логики  
В) Бизнес-логика сначала обращается к БД  
Г) Всё в эндпоинте

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.

### Вопрос 31
Как удалить кеш при обновлении товара? Какую команду Redis вызовешь?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 32
Как middleware может повысить безопасность интеграционных вызовов? Отметь все подходящие варианты.

А) Проверять подписи запросов  
Б) Ограничивать частоту запросов  
В) Валидировать обязательные заголовки  
Г) Игнорировать токены

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware может улучшить безопасность приложения.

### Вопрос 33
Бэкенд обрабатывает тяжёлые отчёты в фоновом планировщике на том же сервере, что и REST API. После запуска фоновых задач latency API вырос. Что поможет снизить влияние на производительность? Отметь все подходящие варианты.

А) Вынести фоновый воркер в отдельный процесс или сервис  
Б) Ограничить количество одновременных задач через пул исполнителей  
В) Кешировать промежуточные результаты и отдавать их, а не пересчитывать каждый раз  
Г) Поднять уровень логирования до DEBUG для задач

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.

### Вопрос 34
Назови три ключевых поля для структурированного лога доступа. Напиши через запятую.

**Правильный ответ:** `timestamp, request_id, path` (принимаются эквиваленты)

**Проверяемый ОР:** Знает. - Что такое логирование и зачем оно нужно.

