# Теоретическая часть контрольной работы. Вариант 4
## Разработка на Python. Профессиональный

### Вопрос 1
В новом проекте ты внедряешь middleware, который должен проставлять `request_id` и `correlation_id`. Как сохранить оба значения для дальнейших обработчиков?

А) Записать их в `request.state`, а затем добавить заголовки после `call_next`  
Б) Сохранить в глобальных переменных  
В) Передавать через query-параметры  
Г) Логировать только `request_id`

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Что такое middleware и его роль в обработке запросов и ответов.

### Вопрос 2
Ты хочешь, чтобы middleware добавляло `X-Service-Version` в каждый ответ. Какие шаги нужны? Отметь все подходящие варианты.

А) В middleware получить версию сервиса  
Б) Вызвать `response = await call_next(request)`  
В) Добавить заголовок `response.headers["X-Service-Version"]`  
Г) Возвращать `None`, FastAPI сам добавит заголовок

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 3
Middleware проверяет IP и ограничивает доступ для небезопасных регионов. Как вынести список блокировки?

А) Загрузить из конфигурации при старте и использовать внутри middleware  
Б) Хранить список в глобальной переменной и менять без синхронизации  
В) Каждый раз считывать файл с диска  
Г) Пропускать все запросы

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Почему middleware полезен для централизованной обработки запросов.

### Вопрос 4
Нужно добавить логирование тела ответов для POST-запросов. Как избежать потери данных в ответе?

А) Скопировать тело, а затем создать новый `Response` с исходными данными  
Б) Использовать `print(response.body)`  
В) Игнорировать большие ответы  
Г) Не логировать ничего

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как middleware влияет на производительность приложения.

### Вопрос 5
Middleware добавляет `user` в `request.state`. Как защититься от отсутствия пользователя?

А) В эндпоинтах проверять `hasattr(request.state, "user")` и бросать 401 при отсутствии  
Б) Хранить `user` в глобальном списке  
В) Использовать `request.headers["user"]`  
Г) Подставлять фиктивного пользователя

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 6
Middleware собирает метрики времени. Какие значения надо логировать? Отметь все подходящие варианты.

А) Время начала  
Б) Время ответа  
В) `latency`  
Г) Идентификатор таблицы БД

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как трассировка запросов помогает в отладке и мониторинге приложения.

### Вопрос 7
Redis используется для кеша конфигурации. Как обезопасить соединение в проде?

А) Включить TLS и проверить сертификат  
Б) Использовать пароль или ACL  
В) Оставить Redis без авторизации  
Г) Использовать встроенный firewall

**Правильные ответы:** А, Б

**Проверяемый ОР:** Знает. - Основы работы с Redis: установка, настройка, базовые команды (SET, GET, DEL).

### Вопрос 8
Метод `/metrics` обновляется каждые 15 минут. Какой TTL поставить для кеша ответа, чтобы балансировать свежесть и нагрузку?

А) 15 минут  
Б) 5 минут  
В) 1 час  
Г) Без кеша

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.

### Вопрос 9
Ключ кеша должен учитывать параметры фильтра `region` и `department`. Как оформить ключ, чтобы команда могла его поддерживать?

**Правильный ответ:** Например, `f"metrics:{region}:{department}"` (принимаются эквиваленты)

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения и как структурировать ключи.

### Вопрос 10
Кеш API иногда даёт устаревшие данные. Какие причины наиболее вероятны? Отметь все подходящие варианты.

А) Источник обновил данные без сброса кеша  
Б) TTL слишком большой  
В) Несогласованность между инстансами, использующими разные ключи  
Г) redis-cli PING

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 11
Нужно сбросить кеш конкретного клиента при изменении его данных. Какие шаги подходят? Отметь все подходящие варианты.

А) Хранить ключи клиента в `SET` и удалять их  
Б) Использовать префикс `client:<id>` и удалять через `SCAN`  
В) `FLUSHALL`  
Г) Ждать истечения TTL

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 12
Эндпоинт возвращает отчёт, который пересчитывается раз в сутки. Как сохранить производительность и актуальность? Отметь все подходящие варианты.

А) Кешировать отчёт с суточным TTL и инвалидировать при обновлении  
Б) Использовать ленивое обновление (stale-while-revalidate)  
В) Не кешировать ответ  
Г) Сбрасывать кеш вручную через CLI раз в час

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Какие стратегии кеширования лучше подходят для разных сценариев.

### Вопрос 13
Как узнать, сколько осталось до истечения ключа `dashboard:data`?

А) `TTL dashboard:data`  
Б) `PTTL dashboard:data`  
В) `PERSIST dashboard:data`  
Г) `EXPIRE dashboard:data 0`

**Правильные ответы:** А, Б

**Проверяемый ОР:** Знает. - Что такое TTL (Time to Live) и как его использовать в кешировании.

### Вопрос 14
Ты строишь общую обёртку вокруг кеша в FastAPI. Какие элементы включишь? Отметь все подходящие варианты.

А) Функцию генерации ключей  
Б) Сериализацию ответов  
В) Инвалидацию при записи в БД  
Г) Миграции схемы БД

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как интегрировать Redis с FastAPI для кеширования API-ответов.

### Вопрос 15
Логирование перегружается из-за лишних полей. Что нужно оставить для технических логов? Отметь все подходящие варианты.

А) `request_id`  
Б) `path`  
В) `status_code`  
Г) `python_version`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 16
На каком уровне логировать успешное завершение фоновой задачи?

А) INFO  
Б) DEBUG  
В) WARNING  
Г) ERROR

**Правильный ответ:** А

**Проверяемый ОР:** Знает. - Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL.

### Вопрос 17
В логах нужно быстро находить записи по пользователю. Какие поля включить? Отметь все подходящие варианты.

А) `timestamp`  
Б) `level`  
В) `user_id`  
Г) `random_number`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Как настраивать форматы логов для удобства чтения.

### Вопрос 18
В проекте используются разные логгеры. Как обеспечить единый формат? Отметь все подходящие варианты.

А) Настроить общий форматтер и подключить его ко всем логгерам  
Б) Использовать `LoggerAdapter`, чтобы автоматически добавлять контекст  
В) Писать логи через `print`  
Г) Создать middleware, которое добавляет формат каждому сообщению

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 19
Нужно запустить отчёт об оплатах каждые 15 минут. Какие шаги нужны при использовании APScheduler? Отметь все подходящие варианты.

А) Создать `AsyncIOScheduler`  
Б) Добавить задачу с `trigger='interval', minutes=15`  
В) Запустить `scheduler.start()`  
Г) Запустить `scheduler.stop()`

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как APScheduler помогает в планировании периодических задач.

### Вопрос 20
В продакшне задача APScheduler внезапно прекращает работать после исключения. Как защититься?

А) Оборачивать задачу в try/except  
Б) Добавить уведомления при исключениях  
В) Ничего не нужно делать, задача перезапустится автоматически  
Г) Логировать ошибки

**Правильные ответы:** А, Б, Г

**Проверяемый ОР:** Понимает. - Какие ошибки могут возникать при работе с фоновыми задачами и как их устранять.

### Вопрос 21
Когда использовать `BackgroundTasks`, а когда APScheduler?

А) `BackgroundTasks` для действий после конкретного запроса, APScheduler — для периодических задач  
Б) APScheduler — для задач, не зависящих от ответа  
В) `BackgroundTasks` запускаются сразу, APScheduler — по триггеру  
Г) APScheduler поддерживает только синхронный код

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Знает. - Различие между BackgroundTasks в FastAPI и APScheduler.

### Вопрос 22
Как сохранить состояние планировщика при рестарте приложения?

А) Использовать persistent job store (Redis, БД)  
Б) Запускать APScheduler в отдельном процессе  
В) Всегда использовать in-memory  
Г) Полагаться на случай

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.

### Вопрос 23
Эндпоинт требует подключения к БД и кешу. Как организовать зависимости, чтобы переиспользовать соединения?

А) Создать зависимость `get_db` и использовать Depends, возвращая сессию  
Б) Создать зависимость `get_cache` для Redis  
В) Создавать соединение внутри эндпоинта через глобальную переменную  
Г) Передавать подключения через аргументы эндпоинта

**Правильные ответы:** А, Б

**Проверяемый ОР:** Понимает. - Как DI помогает в интеграции с внешними сервисами и базами данных.

### Вопрос 24
Почему DI помогает поддерживать крупные проекты? Отметь все подходящие варианты.

А) Упрощает замену реализаций сервисов  
Б) Централизует управление ресурсами  
В) Позволяет тестировать код с заглушками  
Г) Повышает скорость выполнения кода автоматически

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Преимущества DI для тестирования и поддержки кода.

### Вопрос 25
Нужно объявить асинхронную зависимость, которая подключается к Redis и закрывает соединение после использования. Какой шаблон подойдёт?
```python
async def get_redis():
    async with aioredis.from_url(URL) as conn:
        yield conn
```
(принимаются эквиваленты с `yield`)
**Проверяемый ОР:** Понимает. - Как асинхронные зависимости улучшают производительность приложения.

### Вопрос 26
Ты хочешь ограничить доступ к эндпоинту по API-ключу. Как использовать Depends для проверки заголовка?

А) Создать зависимость `verify_api_key` и бросать `HTTPException` при несоответствии  
Б) Проверять ключ внутри каждого эндпоинта  
В) Хранить ключ в глобальной переменной без проверки  
Г) Передавать ключ через swagger

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как Depends помогает централизовать проверки доступа.

### Вопрос 27
Как middleware и зависимости работают вместе?

А) Middleware выполняется до зависимостей и может подготовить контекст  
Б) Зависимости вызываются до middleware  
В) Порядок случайный  
Г) Middleware работает только для GET

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как middleware интегрируется в жизненный цикл запроса в FastAPI.

### Вопрос 28
Как масштабировать настройку приложения через DI?

А) Определить pydantic-модель `Settings` и инжектить её через зависимость  
Б) Читать `.env` внутри каждого эндпоинта  
В) Передавать конфигурацию через тело запроса  
Г) Использовать глобальные переменные

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Почему DI упрощает управление зависимостями в крупных проектах.

### Вопрос 29
Ты хочешь логировать `request_id` в каждом сообщении без явного указания. Как комбинировать middleware и logging?

А) Middleware кладёт `request_id` в `contextvars`, логгер использует фильтр или адаптер  
Б) Добавлять `request_id` вручную в каждой строке  
В) Настроить `LoggerAdapter`, который подмешивает поле  
Г) Отключить контекст ради производительности

**Правильные ответы:** А, В

**Проверяемый ОР:** Понимает. - Как структурированное логирование упрощает анализ логов.

### Вопрос 30
Как построить цепочку кеширование → бизнес-логика?

А) Middleware проверяет кеш и записывает данные в `request.state`, зависимость сервиса использует данные или обращается к БД  
Б) Кеш вызывается после завершения бизнес-логики  
В) Кеш не нужен  
Г) Внутри эндпоинта напрямую

**Правильный ответ:** А

**Проверяемый ОР:** Понимает. - Как кеширование улучшает производительность приложения.

### Вопрос 31
Нужно удалить кеш при обновлении товара. Какую команду Redis вызовешь?

**Правильный ответ:** `DEL key` (принимаются `await redis.delete(key)`)

**Проверяемый ОР:** Понимает. - Как инвалидация кеша помогает поддерживать актуальность данных.

### Вопрос 32
Как middleware может усилить безопасность API? Отметь все подходящие варианты.

А) Проверять обязательные заголовки (например, подпись запроса)  
Б) Ограничивать частоту запросов (rate limiting)  
В) Сбрасывать все запросы с устаревшим токеном  
Г) Игнорировать ошибки

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как middleware может улучшить безопасность приложения.

### Вопрос 33
Бэкенд обрабатывает тяжёлые отчёты в фоновом планировщике на том же сервере, что и REST API. После запуска фоновых задач latency API вырос. Что поможет снизить влияние на производительность? Отметь все подходящие варианты.

А) Вынести фоновый воркер в отдельный процесс или сервис  
Б) Ограничить количество одновременных задач через пул исполнителей  
В) Кешировать промежуточные результаты и отдавать их, а не пересчитывать каждый раз  
Г) Поднять уровень логирования до DEBUG для задач

**Правильные ответы:** А, Б, В

**Проверяемый ОР:** Понимает. - Как фоновые задачи влияют на производительность приложения.

### Вопрос 34
Назови три поля, которые нужно включить в структурированный лог безопасности. Напиши через запятую.

**Правильный ответ:** `timestamp, request_id, user_id` (принимаются эквиваленты)

**Проверяемый ОР:** Знает. - Что такое логирование и зачем оно нужно.

